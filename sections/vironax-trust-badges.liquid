{% comment %}
  VironaX Trust Badges - Enhanced Version
  Scrolling trust badges with comprehensive sticky controls
  Position options: top, bottom, floating
{% endcomment %}

<style>
  #shopify-section-{{ section.id }} {
    --trust-padding-top: {{ section.settings.padding_top }}px;
    --trust-padding-bottom: {{ section.settings.padding_bottom }}px;
    --trust-margin-top: {{ section.settings.margin_top }}px;
    --trust-margin-bottom: {{ section.settings.margin_bottom }}px;
    --trust-bg-opacity: {{ section.settings.background_opacity | divided_by: 100.0 }};
  }

  {% if section.settings.enable_sticky %}
    #shopify-section-{{ section.id }} {
      position: fixed;
      left: 0;
      right: 0;
      z-index: {{ section.settings.z_index | default: 1000 }};
      {% if section.settings.sticky_position == 'top' %}
        top: {{ section.settings.sticky_offset }}px;
      {% else %}
        bottom: {{ section.settings.sticky_offset }}px;
      {% endif %}
      {% unless section.settings.show_always %}
        transform: translateY({% if section.settings.sticky_position == 'bottom' %}100%{% else %}-100%{% endif %});
        transition: transform 0.3s ease;
      {% endunless %}
    }

    #shopify-section-{{ section.id }}.is-visible {
      transform: translateY(0);
    }
  {% endif %}
</style>

<div
  class="vironax-trust-badges{% if section.settings.compact_mode %} vironax-trust-badges--compact{% endif %}"
  data-sticky="{{ section.settings.enable_sticky }}"
  data-position="{{ section.settings.sticky_position | default: 'bottom' }}"
  data-animation="{{ section.settings.animation_style }}"
  data-show-after="{{ section.settings.show_after_scroll }}"
  data-auto-hide="{{ section.settings.auto_hide_seconds }}"
>
  <div class="vironax-trust-badges__track" style="animation-duration: {{ section.settings.scroll_speed }}s;">
    {% for i in (1..3) %}
      <div class="vironax-trust-badges__content">
        <!-- Badge 1: Delivery -->
        {% if section.settings.badge_1 != blank %}
        <div class="vironax-trust-badges__item">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <rect x="1" y="3" width="15" height="13"/><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"/><circle cx="5.5" cy="18.5" r="2.5"/><circle cx="18.5" cy="18.5" r="2.5"/>
          </svg>
          <span>{{ section.settings.badge_1 }}</span>
        </div>
        {% endif %}

        <!-- Badge 2: Certified -->
        {% if section.settings.badge_2 != blank %}
        <div class="vironax-trust-badges__item">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
          </svg>
          <div class="vironax-trust-badges__text-group">
            <span>{{ section.settings.badge_2 }}</span>
            {% if section.settings.badge_2_sub != blank %}
              <span class="vironax-trust-badges__subtext">{{ section.settings.badge_2_sub }}</span>
            {% endif %}
          </div>
        </div>
        {% endif %}

        <!-- Badge 3: Silver -->
        {% if section.settings.badge_3 != blank %}
        <div class="vironax-trust-badges__item">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
          </svg>
          <span>{{ section.settings.badge_3 }}</span>
        </div>
        {% endif %}

        <!-- Badge 4: Guarantee -->
        {% if section.settings.badge_4 != blank %}
        <div class="vironax-trust-badges__item">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>
          </svg>
          <span>{{ section.settings.badge_4 }}</span>
        </div>
        {% endif %}

        <!-- Badge 5: Reviews -->
        {% if section.settings.badge_5 != blank %}
        <div class="vironax-trust-badges__item">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="none">
            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
          </svg>
          <span>{{ section.settings.badge_5 }}</span>
        </div>
        {% endif %}

        <!-- Badge 6: Sold -->
        {% if section.settings.badge_6 != blank %}
        <div class="vironax-trust-badges__item">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="4"/>
          </svg>
          <span>{{ section.settings.badge_6 }}</span>
        </div>
        {% endif %}

        <!-- Badge 7: Payment -->
        {% if section.settings.badge_7 != blank %}
        <div class="vironax-trust-badges__item">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/>
          </svg>
          <span>{{ section.settings.badge_7 }}</span>
        </div>
        {% endif %}
      </div>
    {% endfor %}
  </div>
</div>

<style>
  .vironax-trust-badges {
    background-color: {{ section.settings.background_color | default: '#F8F8F8' }};
    overflow: hidden;
    padding-top: var(--trust-padding-top, var(--spacing-sm));
    padding-bottom: var(--trust-padding-bottom, var(--spacing-sm));
    margin-top: var(--trust-margin-top, 0);
    margin-bottom: var(--trust-margin-bottom, 0);
    border-top: 1px solid rgb(var(--border-color));
    border-bottom: 1px solid rgb(var(--border-color));
  }

  .vironax-trust-badges__track {
    display: flex;
    animation: vironax-trust-scroll 40s linear infinite;
    width: fit-content;
  }

  .vironax-trust-badges__content {
    display: flex;
    align-items: center;
    gap: var(--spacing-2xl);
    padding: 0 var(--spacing-md);
    flex-shrink: 0;
  }

  .vironax-trust-badges__item {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    white-space: nowrap;
  }

  .vironax-trust-badges__item svg {
    flex-shrink: 0;
    color: rgb(var(--text-color));
  }

  .vironax-trust-badges__item span {
    font-family: var(--text-font-family);
    font-size: {{ section.settings.font_size | default: 14 }}px;
    font-weight: {{ section.settings.font_weight | default: 500 }};
    color: rgb(var(--text-color));
    letter-spacing: var(--text-letter-spacing);
  }

  .vironax-trust-badges__text-group {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .vironax-trust-badges__subtext {
    font-size: var(--text-xs) !important;
    font-weight: 400 !important;
    color: rgb(var(--text-color) / 0.6) !important;
    font-style: italic;
  }

  @keyframes vironax-trust-scroll {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-33.333%);
    }
  }

  .vironax-trust-badges:hover .vironax-trust-badges__track {
    animation-play-state: paused;
  }

  /* Compact mode for sticky */
  .vironax-trust-badges--compact {
    padding: var(--spacing-xs) 0 !important;
  }

  .vironax-trust-badges--compact .vironax-trust-badges__item svg {
    width: 16px !important;
    height: 16px !important;
  }

  .vironax-trust-badges--compact .vironax-trust-badges__item span {
    font-size: 12px !important;
  }

  /* Desktop only */
  {% if section.settings.show_on == 'desktop_only' %}
  @media screen and (max-width: 699px) {
    #shopify-section-{{ section.id }} {
      display: none !important;
    }
  }
  {% endif %}

  /* Mobile only */
  {% if section.settings.show_on == 'mobile_only' %}
  @media screen and (min-width: 700px) {
    #shopify-section-{{ section.id }} {
      display: none !important;
    }
  }
  {% endif %}

  @media screen and (max-width: 699px) {
    .vironax-trust-badges__content {
      gap: var(--spacing-xl);
      padding: 0 var(--spacing-sm);
    }

    .vironax-trust-badges__item svg {
      width: 18px;
      height: 18px;
    }

    .vironax-trust-badges__item span {
      font-size: {{ section.settings.font_size_mobile | default: 12 }}px;
    }
  }

  /* Background styles when sticky */
  {% if section.settings.enable_sticky %}
  .vironax-trust-badges[data-sticky="true"] {
    {% case section.settings.sticky_background %}
      {% when 'white' %}
        background-color: #FFFFFF;
      {% when 'transparent' %}
        background-color: transparent;
      {% when 'blur' %}
        background-color: rgba(248, 248, 248, 0.9);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
    {% endcase %}
  }
  {% endif %}
</style>

{% if section.settings.enable_sticky and section.settings.show_always == false %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const badges = document.querySelector('#shopify-section-{{ section.id }}');
    if (!badges) return;

    const showAfter = {{ section.settings.show_after_scroll | default: 300 }};
    const autoHide = {{ section.settings.auto_hide_seconds | default: 0 }} * 1000;
    let hideTimeout;

    function checkScroll() {
      if (window.scrollY > showAfter) {
        badges.classList.add('is-visible');

        if (autoHide > 0) {
          clearTimeout(hideTimeout);
          hideTimeout = setTimeout(function() {
            badges.classList.remove('is-visible');
          }, autoHide);
        }
      } else {
        badges.classList.remove('is-visible');
      }
    }

    window.addEventListener('scroll', checkScroll, { passive: true });
    checkScroll();
  });
</script>
{% endif %}

{% schema %}
{
  "name": "VironaX Trust Badges",
  "settings": [
    {
      "type": "header",
      "content": "Badge Content"
    },
    {
      "type": "text",
      "id": "badge_1",
      "label": "Badge 1",
      "default": "4 Days to Your Doorstep"
    },
    {
      "type": "text",
      "id": "badge_2",
      "label": "Badge 2",
      "default": "Certified Gemstones"
    },
    {
      "type": "text",
      "id": "badge_2_sub",
      "label": "Badge 2 Subtext",
      "default": "Each ring sent with certificate"
    },
    {
      "type": "text",
      "id": "badge_3",
      "label": "Badge 3",
      "default": "925 Sterling Silver"
    },
    {
      "type": "text",
      "id": "badge_4",
      "label": "Badge 4",
      "default": "5 Years Guarantee"
    },
    {
      "type": "text",
      "id": "badge_5",
      "label": "Badge 5",
      "default": "800+ Reviews Â· 4.8 Rating"
    },
    {
      "type": "text",
      "id": "badge_6",
      "label": "Badge 6",
      "default": "15,000+ Rings Sold"
    },
    {
      "type": "text",
      "id": "badge_7",
      "label": "Badge 7",
      "default": "Pay in 4 with Tamara & Tabby"
    },
    {
      "type": "header",
      "content": "Sticky Position Settings"
    },
    {
      "type": "checkbox",
      "id": "enable_sticky",
      "label": "Enable sticky trust badges",
      "info": "Makes badges fixed to top or bottom when scrolling",
      "default": false
    },
    {
      "type": "select",
      "id": "sticky_position",
      "label": "Sticky position",
      "options": [
        { "value": "top", "label": "Top of page" },
        { "value": "bottom", "label": "Bottom of page (recommended)" }
      ],
      "default": "bottom"
    },
    {
      "type": "range",
      "id": "sticky_offset",
      "label": "Offset from top/bottom",
      "min": 0,
      "max": 200,
      "step": 5,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "z_index",
      "label": "Z-index (stacking order)",
      "min": 1,
      "max": 9999,
      "step": 1,
      "default": 1000,
      "info": "Higher values appear above other elements"
    },
    {
      "type": "select",
      "id": "show_on",
      "label": "Show on",
      "options": [
        { "value": "all", "label": "Desktop and Mobile" },
        { "value": "desktop_only", "label": "Desktop only" },
        { "value": "mobile_only", "label": "Mobile only" }
      ],
      "default": "all"
    },
    {
      "type": "header",
      "content": "Show/Hide Behavior"
    },
    {
      "type": "checkbox",
      "id": "show_always",
      "label": "Always visible when sticky",
      "info": "If unchecked, badges appear after scrolling",
      "default": true
    },
    {
      "type": "range",
      "id": "show_after_scroll",
      "label": "Show after scrolling (px)",
      "info": "Only applies if 'Always visible' is off",
      "min": 100,
      "max": 1000,
      "step": 50,
      "unit": "px",
      "default": 300
    },
    {
      "type": "range",
      "id": "auto_hide_seconds",
      "label": "Auto-hide after (seconds)",
      "info": "Set to 0 to never auto-hide",
      "min": 0,
      "max": 30,
      "step": 1,
      "default": 0
    },
    {
      "type": "select",
      "id": "animation_style",
      "label": "Animation when appearing",
      "options": [
        { "value": "slide", "label": "Slide in" },
        { "value": "fade", "label": "Fade in" },
        { "value": "none", "label": "None" }
      ],
      "default": "slide"
    },
    {
      "type": "header",
      "content": "Sticky Background Style"
    },
    {
      "type": "select",
      "id": "sticky_background",
      "label": "Background when sticky",
      "options": [
        { "value": "default", "label": "Default (light gray)" },
        { "value": "white", "label": "White" },
        { "value": "transparent", "label": "Transparent" },
        { "value": "blur", "label": "Blur effect" }
      ],
      "default": "default"
    },
    {
      "type": "checkbox",
      "id": "compact_mode",
      "label": "Compact mode when sticky",
      "info": "Smaller icons and text when fixed",
      "default": false
    },
    {
      "type": "header",
      "content": "Appearance"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#F8F8F8"
    },
    {
      "type": "range",
      "id": "scroll_speed",
      "label": "Scroll speed (seconds)",
      "info": "Lower = faster",
      "min": 20,
      "max": 80,
      "step": 5,
      "default": 40
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "range",
      "id": "font_size",
      "label": "Font size (desktop)",
      "min": 11,
      "max": 18,
      "step": 1,
      "unit": "px",
      "default": 14
    },
    {
      "type": "range",
      "id": "font_size_mobile",
      "label": "Font size (mobile)",
      "min": 10,
      "max": 14,
      "step": 1,
      "unit": "px",
      "default": 12
    },
    {
      "type": "select",
      "id": "font_weight",
      "label": "Font weight",
      "options": [
        { "value": "400", "label": "Regular" },
        { "value": "500", "label": "Medium" },
        { "value": "600", "label": "Semi-bold" }
      ],
      "default": "500"
    },
    {
      "type": "header",
      "content": "Padding Settings"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Padding top",
      "min": 0,
      "max": 40,
      "step": 2,
      "unit": "px",
      "default": 10
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Padding bottom",
      "min": 0,
      "max": 40,
      "step": 2,
      "unit": "px",
      "default": 10
    },
    {
      "type": "header",
      "content": "Spacing Settings"
    },
    {
      "type": "range",
      "id": "margin_top",
      "label": "Margin top",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "margin_bottom",
      "label": "Margin bottom",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 0
    }
  ],
  "presets": [
    {
      "name": "VironaX Trust Badges"
    }
  ]
}
{% endschema %}
